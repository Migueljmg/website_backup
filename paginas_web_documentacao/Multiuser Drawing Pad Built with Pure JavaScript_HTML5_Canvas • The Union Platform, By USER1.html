<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0042)http://www.unionplatform.com/?page_id=2762 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="shortcut icon" href="http://www.unionplatform.com/favicon.ico">
<link rel="icon" type="image/vnd.microsoft.icon" href="http://www.unionplatform.com/favicon.ico">


<meta name="description" content="Union is a development platform for creating connected applications and games in JavaScript, Adobe Flash, .net, Java, and other languages. Union is free for up to 1000 simultaneous users.">
<meta name="keywords" content="Union Platform, JavaScript, HTML5, AJAX, iPhone, Android, mobile, WebSocket, WebSocket server, ActionScript, Java, socket server, multiuser, multiuser server, sdk, server, Flash, Adobe, free, node.js, tutorial, example, code, collaborative, social, connected, realtime, development, client, pong, fridge magnets, games, whiteboard, chat, lobby, online, multiplayer, sample, moock, clayton">
<link rel="stylesheet" type="text/css" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/style.css">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.unionplatform.com/?feed=rss2">
<link rel="alternate" type="text/xml" title="RSS .92" href="http://www.unionplatform.com/?feed=rss">
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://www.unionplatform.com/?feed=atom">
<link rel="pingback" href="http://www.unionplatform.com/wp/xmlrpc.php">
<title>Multiuser Drawing Pad Built with Pure JavaScript/HTML5/Canvas • The Union Platform, By USER1</title>
<link rel="stylesheet" id="codecolorer-css" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/codecolorer.css" type="text/css" media="screen">
<script type="text/javascript" async="" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/ga.js"></script><script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/swfobject.js"></script>
<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/jquery.js"></script>
<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/include.js"></script>
<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.unionplatform.com/wp/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.unionplatform.com/wp/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="The Union Platform, By USER1" href="http://www.unionplatform.com/">
<link rel="up" title="OrbiterMicro Examples" href="http://www.unionplatform.com/?page_id=2200">
<meta name="generator" content="WordPress 2.9.2">
<link rel="canonical" href="http://www.unionplatform.com/?page_id=2762">


<!-- Dropdown Menu Widget Styles by shailan (http://shailan.com) v1.6.2 on wp2.9.2 -->
<link rel="stylesheet" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shailan-dropdown.css" type="text/css">
<link rel="stylesheet" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/grayscale.css" type="text/css">
<style type="text/css" media="all">
	ul.dropdown li a { font-size:13px; }
	ul.dropdown { white-space: nowrap;	}	
	/** Show submenus */
	ul.dropdown li:hover > ul, ul.dropdown li.hover ul{ display: block; }
	
	/** Show current submenu */
	ul.dropdown li.hover ul, ul.dropdown ul li.hover ul, ul.dropdown ul ul li.hover ul, ul.dropdown ul ul ul li.hover ul, ul.dropdown ul ul ul ul li.hover ul , ul.dropdown li:hover ul, ul.dropdown ul li:hover ul, ul.dropdown ul ul li:hover ul, ul.dropdown ul ul ul li:hover ul, ul.dropdown ul ul ul ul li:hover ul { display: block; } 
				
			
</style>
<!-- /Dropdown Menu Widget Styles -->

 <!-- Google Analytics Tracking by Google Analyticator 6.1.3: http://ronaldheft.com/code/analyticator/ -->
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-23154724-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
<link rel="stylesheet" type="text/css" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shThemeFadeToGrey.css"></head>

<body>
<div id="pagewidth">

<div id="page">

<div id="header" onclick="document.location=&#39;/&#39;;" style="cursor:pointer;hand">

<!--<h1><a href="http://www.unionplatform.com" title="The Union Platform, By USER1">The Union Platform, By USER1</a></h1>
<h2></h2>-->

</div>

<div id="wrapper" class="clearfix">

<div style="padding-left:30px;padding-right:30px"><div class="widget shailan-dropdown-menu">
<!-- Dropdown Menu Widget by shailan (http://shailan.com)  v1.6.2 on wp2.9.2 -->
<!-- Menu Type : pages -->
<div id="shailan-dropdown-wrapper--1">
	<div align="left" class="dropdown-horizontal-container dm-align-left"><table cellpadding="0" cellspacing="0"><tbody><tr><td>
		<ul id="dropdown--1" class="dropdown dropdown--1 dropdown-horizontal dropdown-align-left">
<!-- Menu elements start -->
<li class="page_item page-item-1814 parent first-child"><a href="http://www.unionplatform.com/?page_id=1814" title="Hello Union!">Hello Union!</a>
<ul>
	<li class="page_item page-item-1994 first-child"><a href="http://www.unionplatform.com/?page_id=1994" title="Union Quick Start">Union Quick Start</a></li>
	<li class="page_item page-item-239"><a href="http://www.unionplatform.com/?page_id=239" title="tryunion.com">tryunion.com</a></li>
	<li class="page_item page-item-1216"><a href="http://www.unionplatform.com/?page_id=1216" title="Code Examples">Code Examples</a></li>
	<li class="page_item page-item-30"><a href="http://www.unionplatform.com/?page_id=30" title="Union Core Concepts">Union Core Concepts</a></li>
	<li class="page_item page-item-2446"><a href="http://www.unionplatform.com/?page_id=2446" title="Union Features">Union Features</a></li>
	<li class="page_item page-item-2192 last-child"><a href="http://www.unionplatform.com/?page_id=2192" title="The Multiuser Era">The Multiuser Era</a></li>
</ul>
</li>
<li class="page_item page-item-5 parent"><a href="http://www.unionplatform.com/?page_id=5" title="Union Server">Union Server</a>
<ul>
	<li class="page_item page-item-1833 first-child"><a href="http://www.unionplatform.com/?page_id=1833" title="Download Union Server">Download Union Server</a></li>
	<li class="page_item page-item-411"><a href="http://www.unionplatform.com/?page_id=411" title="System Requirements">System Requirements</a></li>
	<li class="page_item page-item-418 parent"><a href="http://www.unionplatform.com/?page_id=418" title="Union Admin">Union Admin</a>
	<ul>
		<li class="page_item page-item-1912 first-child"><a href="http://www.unionplatform.com/?page_id=1912" title="Download Union Admin">Download Union Admin</a></li>
		<li class="page_item page-item-1875 last-child"><a href="http://www.unionplatform.com/?page_id=1875" title="Setup">Setup</a></li>
	</ul>
</li>
	<li class="page_item page-item-1924 parent"><a href="http://www.unionplatform.com/?page_id=1924" title="Union User Guide">Union User Guide</a>
	<ul>
		<li class="page_item page-item-414 first-child"><a href="http://www.unionplatform.com/?page_id=414" title="Installation and Startup">Installation and Startup</a></li>
		<li class="page_item page-item-2535"><a href="http://www.unionplatform.com/?page_id=2535" title="Activating a Union Licence">Activating a Union Licence</a></li>
		<li class="page_item page-item-416"><a href="http://www.unionplatform.com/?page_id=416" title="Configuration">Configuration</a></li>
		<li class="page_item page-item-677"><a href="http://www.unionplatform.com/?page_id=677" title="Rooms">Rooms</a></li>
		<li class="page_item page-item-2643 parent"><a href="http://www.unionplatform.com/?page_id=2643" title="Modules">Modules</a>
		<ul>
			<li class="page_item page-item-11 first-child"><a href="http://www.unionplatform.com/?page_id=11" title="Creating Server Modules with Java">Creating Server Modules with Java</a></li>
			<li class="page_item page-item-1072"><a href="http://www.unionplatform.com/?page_id=1072" title="Creating Room Modules with Java">Creating Room Modules with Java</a></li>
			<li class="page_item page-item-2615"><a href="http://www.unionplatform.com/?page_id=2615" title="Creating Room Modules with JavaScript">Creating Room Modules with JavaScript</a></li>
			<li class="page_item page-item-3151"><a href="http://www.unionplatform.com/?page_id=3151" title="Sending and Receiving a Room Module Message with JavaScript">Sending and Receiving a Room Module Message with JavaScript</a></li>
			<li class="page_item page-item-3127"><a href="http://www.unionplatform.com/?page_id=3127" title="JavaScript Twitter-Feed Room Module">JavaScript Twitter-Feed Room Module</a></li>
			<li class="page_item page-item-843"><a href="http://www.unionplatform.com/?page_id=843" title="Handling Events in Modules">Handling Events in Modules</a></li>
			<li class="page_item page-item-3073"><a href="http://www.unionplatform.com/?page_id=3073" title="Inter-module Communication">Inter-module Communication</a></li>
			<li class="page_item page-item-2821 last-child"><a href="http://www.unionplatform.com/?page_id=2821" title="Reloading Modules">Reloading Modules</a></li>
		</ul>
</li>
		<li class="page_item page-item-837 parent"><a href="http://www.unionplatform.com/?page_id=837" title="Persistence">Persistence</a>
		<ul>
			<li class="page_item page-item-3721 first-child last-child"><a href="http://www.unionplatform.com/?page_id=3721" title="Persistence Tutorial: MySQL Datasource">Persistence Tutorial: MySQL Datasource</a></li>
		</ul>
</li>
		<li class="page_item page-item-725 parent"><a href="http://www.unionplatform.com/?page_id=725" title="Security">Security</a>
		<ul>
			<li class="page_item page-item-3827 first-child last-child"><a href="http://www.unionplatform.com/?page_id=3827" title="TLS/SSL Configuration">TLS/SSL Configuration</a></li>
		</ul>
</li>
		<li class="page_item page-item-420"><a href="http://www.unionplatform.com/?page_id=420" title="Gateways">Gateways</a></li>
		<li class="page_item page-item-1653"><a href="http://www.unionplatform.com/?page_id=1653" title="Server Log">Server Log</a></li>
		<li class="page_item page-item-86 parent"><a href="http://www.unionplatform.com/?page_id=86" title="UPC Protocol">UPC Protocol</a>
		<ul>
			<li class="page_item page-item-1134 first-child last-child"><a href="http://www.unionplatform.com/?page_id=1134" title="Union Handshake">Union Handshake</a></li>
		</ul>
</li>
		<li class="page_item page-item-3706"><a href="http://www.unionplatform.com/?page_id=3706" title="Client/Server Compatibility">Client/Server Compatibility</a></li>
		<li class="page_item page-item-3190 parent last-child"><a href="http://www.unionplatform.com/?page_id=3190" title="Clustering Union Server">Clustering Union Server</a>
		<ul>
			<li class="page_item page-item-3193 first-child last-child"><a href="http://www.unionplatform.com/?page_id=3193" title="Clustering Tutorial: Survey">Clustering Tutorial: Survey</a></li>
		</ul>
</li>
	</ul>
</li>
	<li class="page_item page-item-443 last-child"><a href="http://www.unionplatform.com/?page_id=443" title="Union API Reference">Union API Reference</a></li>
</ul>
</li>
<li class="page_item page-item-1748 current_page_ancestor parent"><a href="http://www.unionplatform.com/?page_id=1748" title="Client Frameworks">Client Frameworks</a>
<ul>
	<li class="page_item page-item-3248 parent first-child"><a href="http://www.unionplatform.com/?page_id=3248" title="Orbiter (JavaScript Client)">Orbiter (JavaScript Client)</a>
	<ul>
		<li class="page_item page-item-3271 first-child"><a href="http://www.unionplatform.com/?page_id=3271" title="Orbiter Quick Start">Orbiter Quick Start</a></li>
		<li class="page_item page-item-3291 parent"><a href="http://www.unionplatform.com/?page_id=3291" title="Orbiter Examples">Orbiter Examples</a>
		<ul>
			<li class="page_item page-item-3318 first-child"><a href="http://www.unionplatform.com/?page_id=3318" title="Chat">Chat</a></li>
			<li class="page_item page-item-3815"><a href="http://www.unionplatform.com/?page_id=3815" title="Shared Whiteboard">Shared Whiteboard</a></li>
			<li class="page_item page-item-3306"><a href="http://www.unionplatform.com/?page_id=3306" title="User List">User List</a></li>
			<li class="page_item page-item-3316"><a href="http://www.unionplatform.com/?page_id=3316" title="User List (Dojo DGrid)">User List (Dojo DGrid)</a></li>
			<li class="page_item page-item-3393"><a href="http://www.unionplatform.com/?page_id=3393" title="Account Login">Account Login</a></li>
			<li class="page_item page-item-3407"><a href="http://www.unionplatform.com/?page_id=3407" title="Save User Data">Save User Data</a></li>
			<li class="page_item page-item-3429"><a href="http://www.unionplatform.com/?page_id=3429" title="Share User Data">Share User Data</a></li>
			<li class="page_item page-item-3414"><a href="http://www.unionplatform.com/?page_id=3414" title="Share Application State">Share Application State</a></li>
			<li class="page_item page-item-3475"><a href="http://www.unionplatform.com/?page_id=3475" title="Save Application State">Save Application State</a></li>
			<li class="page_item page-item-3495"><a href="http://www.unionplatform.com/?page_id=3495" title="Live Room List">Live Room List</a></li>
			<li class="page_item page-item-3695"><a href="http://www.unionplatform.com/?page_id=3695" title="Lobby">Lobby</a></li>
			<li class="page_item page-item-3610"><a href="http://www.unionplatform.com/?page_id=3610" title="Team Chat">Team Chat</a></li>
			<li class="page_item page-item-3596"><a href="http://www.unionplatform.com/?page_id=3596" title="Account List (Snapshot)">Account List (Snapshot)</a></li>
			<li class="page_item page-item-3598"><a href="http://www.unionplatform.com/?page_id=3598" title="Account Record (Snapshot)">Account Record (Snapshot)</a></li>
			<li class="page_item page-item-3602"><a href="http://www.unionplatform.com/?page_id=3602" title="User Count (Snapshot)">User Count (Snapshot)</a></li>
			<li class="page_item page-item-3607"><a href="http://www.unionplatform.com/?page_id=3607" title="Client Record (Snapshot)">Client Record (Snapshot)</a></li>
			<li class="page_item page-item-3623"><a href="http://www.unionplatform.com/?page_id=3623" title="Room List (Snapshot)">Room List (Snapshot)</a></li>
			<li class="page_item page-item-3625 last-child"><a href="http://www.unionplatform.com/?page_id=3625" title="Room Record (Snapshot)">Room Record (Snapshot)</a></li>
		</ul>
</li>
		<li class="page_item page-item-3279"><a href="http://www.unionplatform.com/?page_id=3279" title="API Reference">API Reference</a></li>
		<li class="page_item page-item-3298"><a href="http://www.unionplatform.com/?page_id=3298" title="Installing Hosted Orbiter">Installing Hosted Orbiter</a></li>
		<li class="page_item page-item-3286"><a href="http://www.unionplatform.com/?page_id=3286" title="System Requirements">System Requirements</a></li>
		<li class="page_item page-item-3281 last-child"><a href="http://www.unionplatform.com/?page_id=3281" title="Download Orbiter">Download Orbiter</a></li>
	</ul>
</li>
	<li class="page_item page-item-1587 current_page_ancestor parent"><a href="http://www.unionplatform.com/?page_id=1587" title="OrbiterMicro (Light JS Client)">OrbiterMicro (Light JS Client)</a>
	<ul>
		<li class="page_item page-item-2202 first-child"><a href="http://www.unionplatform.com/?page_id=2202" title="OrbiterMicro Quick Start">OrbiterMicro Quick Start</a></li>
		<li class="page_item page-item-2200 current_page_ancestor current_page_parent parent"><a href="http://www.unionplatform.com/?page_id=2200" title="OrbiterMicro Examples">OrbiterMicro Examples</a>
		<ul>
			<li class="page_item page-item-2247 first-child"><a href="http://www.unionplatform.com/?page_id=2247" title="OrbiterMicro Chat Example">OrbiterMicro Chat Example</a></li>
			<li class="page_item page-item-2762 current_page_item"><a href="http://www.unionplatform.com/?page_id=2762" title="Multiuser Drawing Pad Built with Pure JavaScript/HTML5/Canvas">Multiuser Drawing Pad Built with Pure JavaScript/HTML5/Canvas</a></li>
			<li class="page_item page-item-3360"><a href="http://www.unionplatform.com/?page_id=3360" title="On-Screen Logging">On-Screen Logging</a></li>
			<li class="page_item page-item-3369 last-child"><a href="http://www.unionplatform.com/?page_id=3369" title="User Counter">User Counter</a></li>
		</ul>
</li>
		<li class="page_item page-item-1611"><a href="http://www.unionplatform.com/?page_id=1611" title="Features">Features</a></li>
		<li class="page_item page-item-1589"><a href="http://www.unionplatform.com/?page_id=1589" title="API Reference">API Reference</a></li>
		<li class="page_item page-item-1625"><a href="http://www.unionplatform.com/?page_id=1625" title="System Requirements">System Requirements</a></li>
		<li class="page_item page-item-2954"><a href="http://www.unionplatform.com/?page_id=2954" title="Introduction to WebSocket">Introduction to WebSocket</a></li>
		<li class="page_item page-item-3442"><a href="http://www.unionplatform.com/?page_id=3442" title="Installing Hosted OrbiterMicro">Installing Hosted OrbiterMicro</a></li>
		<li class="page_item page-item-1604 last-child"><a href="http://www.unionplatform.com/?page_id=1604" title="Download OrbiterMicro">Download OrbiterMicro</a></li>
	</ul>
</li>
	<li class="page_item page-item-2843 parent"><a href="http://www.unionplatform.com/?page_id=2843" title="OrbiterMicroNode (Node.JS Client)">OrbiterMicroNode (Node.JS Client)</a>
	<ul>
		<li class="page_item page-item-2861 first-child"><a href="http://www.unionplatform.com/?page_id=2861" title="OrbiterMicroNode Quick Start">OrbiterMicroNode Quick Start</a></li>
		<li class="page_item page-item-2853"><a href="http://www.unionplatform.com/?page_id=2853" title="Download OrbiterMicroNode">Download OrbiterMicroNode</a></li>
		<li class="page_item page-item-2875"><a href="http://www.unionplatform.com/?page_id=2875" title="Chat Bot Example">Chat Bot Example</a></li>
		<li class="page_item page-item-2881 last-child"><a href="http://www.unionplatform.com/?page_id=2881" title="Load Test Example">Load Test Example</a></li>
	</ul>
</li>
	<li class="page_item page-item-7 parent"><a href="http://www.unionplatform.com/?page_id=7" title="Reactor (Flash Client)">Reactor (Flash Client)</a>
	<ul>
		<li class="page_item page-item-1737 first-child"><a href="http://www.unionplatform.com/?page_id=1737" title="Download Reactor">Download Reactor</a></li>
		<li class="page_item page-item-1867"><a href="http://www.unionplatform.com/?page_id=1867" title="System Requirements">System Requirements</a></li>
		<li class="page_item page-item-41"><a href="http://www.unionplatform.com/?page_id=41" title="Reactor API Reference">Reactor API Reference</a></li>
		<li class="page_item page-item-1744 parent"><a href="http://www.unionplatform.com/?page_id=1744" title="Reactor Examples">Reactor Examples</a>
		<ul>
			<li class="page_item page-item-44 first-child"><a href="http://www.unionplatform.com/?page_id=44" title="Reactor Chat Tutorial, Part 1">Reactor Chat Tutorial, Part 1</a></li>
			<li class="page_item page-item-464"><a href="http://www.unionplatform.com/?page_id=464" title="Reactor Chat Tutorial, Part 2">Reactor Chat Tutorial, Part 2</a></li>
			<li class="page_item page-item-599"><a href="http://www.unionplatform.com/?page_id=599" title="Reactor Chat Tutorial, Part 3">Reactor Chat Tutorial, Part 3</a></li>
			<li class="page_item page-item-1065"><a href="http://www.unionplatform.com/?page_id=1065" title="ClientCountSnapshot Example">ClientCountSnapshot Example</a></li>
			<li class="page_item page-item-801"><a href="http://www.unionplatform.com/?page_id=801" title="Lobby Example">Lobby Example</a></li>
			<li class="page_item page-item-831"><a href="http://www.unionplatform.com/?page_id=831" title="Multiuser Clipboard">Multiuser Clipboard</a></li>
			<li class="page_item page-item-1159"><a href="http://www.unionplatform.com/?page_id=1159" title="Multiuser Fridge Magnets">Multiuser Fridge Magnets</a></li>
			<li class="page_item page-item-1229"><a href="http://www.unionplatform.com/?page_id=1229" title="Online Multiplayer Pong!">Online Multiplayer Pong!</a></li>
			<li class="page_item page-item-1050"><a href="http://www.unionplatform.com/?page_id=1050" title="RoomListSnapshot Example">RoomListSnapshot Example</a></li>
			<li class="page_item page-item-1565"><a href="http://www.unionplatform.com/?page_id=1565" title="RoomSnapshot Example">RoomSnapshot Example</a></li>
			<li class="page_item page-item-942 last-child"><a href="http://www.unionplatform.com/?page_id=942" title="User Account Registration/Login">User Account Registration/Login</a></li>
		</ul>
</li>
		<li class="page_item page-item-962 parent last-child"><a href="http://www.unionplatform.com/?page_id=962" title="ReactorGUI (Flash UI Framework)">ReactorGUI (Flash UI Framework)</a>
		<ul>
			<li class="page_item page-item-1838 first-child"><a href="http://www.unionplatform.com/?page_id=1838" title="Download ReactorGUI">Download ReactorGUI</a></li>
			<li class="page_item page-item-1841"><a href="http://www.unionplatform.com/?page_id=1841" title="System Requirements">System Requirements</a></li>
			<li class="page_item page-item-1846"><a href="http://www.unionplatform.com/?page_id=1846" title="ReactorGUI API Reference">ReactorGUI API Reference</a></li>
			<li class="page_item page-item-1760 last-child"><a href="http://www.unionplatform.com/?page_id=1760" title="ReactorGUI Examples">ReactorGUI Examples</a></li>
		</ul>
</li>
	</ul>
</li>
	<li class="page_item page-item-3452"><a href="http://www.unionplatform.com/?page_id=3452" title="Union CDN">Union CDN</a></li>
	<li class="page_item page-item-2066 last-child"><a href="http://www.unionplatform.com/?page_id=2066" title="Create a Custom Client">Create a Custom Client</a></li>
</ul>
</li>
<li class="page_item page-item-1568"><a href="http://www.unionplatform.com/?page_id=1568" title="Forums">Forums</a></li>
<li class="page_item page-item-437"><a href="http://www.unionplatform.com/?page_id=437" title="Download">Download</a></li>
<li class="page_item page-item-1111 last-child"><a href="http://www.unionplatform.com/?page_id=1111" title="Buy">Buy</a></li>

					</ul></td>
				  </tr></tbody></table> 
				</div></div> 

<!--/ Dropdown Menu Widget -->			
              </div>        </div>


<div id="content">


	<!-- SUBPAGES : This page doesn't have any subpages. -->
<div id="sidebar">

<!--<h2>News</h2>

<ul id="newsmenu">
	<li><a href='http://www.unionplatform.com/?m=201401' title='January 2014'>January 2014</a></li>
	<li><a href='http://www.unionplatform.com/?m=201305' title='May 2013'>May 2013</a></li>
	<li><a href='http://www.unionplatform.com/?m=201301' title='January 2013'>January 2013</a></li>
	<li><a href='http://www.unionplatform.com/?m=201211' title='November 2012'>November 2012</a></li>
	<li><a href='http://www.unionplatform.com/?m=201207' title='July 2012'>July 2012</a></li>
	<li><a href='http://www.unionplatform.com/?m=201206' title='June 2012'>June 2012</a></li>
	<li><a href='http://www.unionplatform.com/?m=201205' title='May 2012'>May 2012</a></li>
	<li><a href='http://www.unionplatform.com/?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201108' title='August 2011'>August 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='http://www.unionplatform.com/?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='http://www.unionplatform.com/?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='http://www.unionplatform.com/?m=200903' title='March 2009'>March 2009</a></li>
</ul>

-->
</div>
<!--<div id="submenu"><span class="submenutop"></span><span class="submenuheader">Client Frameworks</span><ul id="submenunav"><li class="page_item page-item-3248"><a href="http://www.unionplatform.com/?page_id=3248" title="Orbiter (JavaScript Client)">Orbiter (JavaScript Client)</a></li>
<li class="page_item page-item-1587 current_page_ancestor"><a href="http://www.unionplatform.com/?page_id=1587" title="OrbiterMicro (Light JS Client)">OrbiterMicro (Light JS Client)</a></li>
<li class="page_item page-item-2843"><a href="http://www.unionplatform.com/?page_id=2843" title="OrbiterMicroNode (Node.JS Client)">OrbiterMicroNode (Node.JS Client)</a></li>
<li class="page_item page-item-7"><a href="http://www.unionplatform.com/?page_id=7" title="Reactor (Flash Client)">Reactor (Flash Client)</a></li>
<li class="page_item page-item-3452"><a href="http://www.unionplatform.com/?page_id=3452" title="Union CDN">Union CDN</a></li>
<li class="page_item page-item-2066"><a href="http://www.unionplatform.com/?page_id=2066" title="Create a Custom Client">Create a Custom Client</a></li>
</ul><span class="submenubase"></span></div>-->



<div class="pageParentLinkDiv"><a class="pageParentLink" href="http://www.unionplatform.com/?page_id=2200">OrbiterMicro Examples</a></div>



<h1><a href="http://www.unionplatform.com/?page_id=2762" rel="bookmark" title="Multiuser Drawing Pad Built with Pure JavaScript/HTML5/Canvas">Multiuser Drawing Pad Built with Pure JavaScript/HTML5/Canvas</a></h1>
<p>This example shows how to create a simple multiuser drawing pad (aka shared whiteboard, multiuser sketchpad, or collaborative painting tool) using pure JavaScript and HTML5's &lt;canvas&gt; tag. The drawing pad updates in realtime when any connected user draws a line.</p>
<p>Here's UnionDraw. Have a scribble!</p>
<p><iframe style="padding-left: 100px" frameborder="0" scrolling="no" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/uniondraw.html" width="100%" height="435"></iframe></p>
<p align="center">
[<a href="http://unionplatform.com/samples/orbitermicro/UnionDraw">View source</a>]
</p>
<p>To manage communication between users, the JavaScript code uses <a href="http://www.unionplatform.com/?page_id=1587">OrbiterMicro</a>, which connects to <a href="http://www.unionplatform.com/?page_id=5">Union Server</a>. For maximum speed, the connection to Union Server is made over <a href="http://www.unionplatform.com/?page_id=2954">WebSocket</a> in browsers that support it. Where WebSocket is not supported, OrbiterMicro automatically falls back to Union platform's <a href="http://www.unionplatform.com/?page_id=2066">binary request model</a> for responsive two-way communication over traditional HTTP.</p>
<p>The drawing pad works in Firefox 3+, Chrome 1+, Safari 4+, iPad, iPhone 3+, Android 2.1+, Internet Explorer 8+, and Opera 9.5+. Support for &lt;canvas&gt; in Internet Explorer 8 is provided by Google's <a href="http://code.google.com/p/explorercanvas/">ExplorerCanvas</a>. </p>
<p>Stripped of comments and line breaks, the code is about 350 lines of client-side JavaScript, and requires <em>no server-side programming</em>.</p>
<h2>The Code</h2>
<p>UnionDraw is broken into two files: an HTML wrapper that provides the drawing canvas and basic user interface, and a JavaScript file that implements the application logic. Both files are shown below.</p>
<p>UnionDraw requires access to a <a href="http://www.unionplatform.com/?page_id=5">Union Server</a>. In this example, we connect to the public test server <a href="http://www.unionplatform.com/?page_id=239">tryunion.com</a>. </p>
<p>The multiuser aspects of the shared drawing program rely on three key <a href="http://www.unionplatform.com/?page_id=2446">Union platform features</a>: rooms, client attributes, and room messages. </p>
<p>UnionDraw's room is named "examples.uniondraw". It gives users a place in which to share information, such as drawing commands and line styles. Upon joining the "examples.uniondraw" room, users automatically begin receiving updates relevant to the drawing application. For example, a user might receive an update such as: "user 236 drew a line from 40,45 to 65, 50". Because users join "examples.uniondraw", and not any other room, they automatically ignore traffic generated by other applications on the server. For example, a UnionDraw client never receives the position of the ball in the <a href="http://www.unionplatform.com/?page_id=1229">Union Pong</a> room, which also runs on tryunion.com.</p>
<p>UnionDraw's client attributes specify each user's current line thickness and color. The attributes are named, appropriately, "thickness" and "color". When a client changes its "color" attribute to, say, "#666666", all other clients in the "examples.uniondraw" room are instantly notified of the change. To change an attribute, clients use the MessageManager's sendUPC() command to send a SET_CLIENT_ATTR message to the server. For example, the following code changes the attribute named "thickness":</p>
<div id="highlighter_210136" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">msgManager.sendUPC(UPC.SET_CLIENT_ATTR,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">orbiter.getClientID(),</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Attributes.THICKNESS,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">newThickness,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"4"</code><code class="plain">);</code></td></tr></tbody></table></div></div></div>
<p>To be notified of attribute changes received from other clients, each client registers a message listener for CLIENT_ATTR_UPDATE messages, as follows:</p>
<div id="highlighter_143734" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">msgManager.addMessageListener(UPC.CLIENT_ATTR_UPDATE, clientAttributeUpdateListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div></div></div>
<p>The list of available UPC ("Union Procedure Call") messages is documented in the <a href="http://unionplatform.com/specs/upc/">UPC Specification</a>. Unlike <a href="http://www.unionplatform.com/?page_id=3248">Orbiter</a> and <a href="http://www.unionplatform.com/?page_id=7">Reactor</a>, OrbiterMicro applications send raw UPC messages directly. The lower-level API keeps OrbiterMicro's file size small, making OrbiterMicro usable in bandwidth-limited environments, such as mobile devices.</p>
<p>UnionDraw's room messages include the MOVE message and the PATH message. A client sends a MOVE room message when it wishes to inform other clients in the "examples.uniondraw" room that it has moved its drawing pen position. A client sends a PATH room message when it wishes to inform other clients in the "examples.uniondraw" room that it has drawn a line. The PATH room message includes the list of points in the new line.  To send a room message, clients use the MessageManager's sendUPC() command to send a SEND_MESSAGE_TO_ROOMS message to the server. For example, the following code sends a "MOVE" message to all clients in the "examples.uniondraw" room (arguments for SEND_MESSAGE_TO_ROOMS are listed in the <a href="http://unionplatform.com/specs/upc/">UPC Specification</a>):</p>
<div id="highlighter_34259" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">msgManager.sendUPC(UPC.SEND_MESSAGE_TO_ROOMS,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Messages.MOVE,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"false"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">x + </code><code class="string">","</code> <code class="plain">+ y);</code></td></tr></tbody></table></div></div></div>
<p>To be notified when MOVE and PATH messages are received from other clients, each client registers a message listener for MOVE and PATH, as follows:</p>
<div id="highlighter_192689" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">msgManager.addMessageListener(Messages.MOVE, moveMessageListener, </code><code class="keyword">this</code><code class="plain">, [roomID]);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">msgManager.addMessageListener(Messages.PATH, pathMessageListener, </code><code class="keyword">this</code><code class="plain">, [roomID]);</code></td></tr></tbody></table></div></div></div>
<p>Both the MOVE and PATH messages are determined by UnionDraw's application code. Each Union platform application defines its own attributes and messages, and uses its attributes to share data and its messages to send commands to the server and to other clients.</p>
<p>Now here's the source code for UnionDraw.</p>
<h2>uniondraw.html</h2>
<div class="codeblock">
<div id="highlighter_487093" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">html</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">head</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">title</code><code class="plain">&gt;UnionDraw: Multiuser Drawing Pad in JavaScript&lt;/</code><code class="keyword">title</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;!--Prevents iPhone, iPad, and touch devices from scrolling or zooming when touched--&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">meta</code> <code class="color1">name</code><code class="plain">=</code><code class="string">"viewport"</code> <code class="color1">content</code><code class="plain">=</code><code class="string">"width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"</code> <code class="plain">/&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">&lt;!--CSS--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">style</code> <code class="color1">type</code><code class="plain">=</code><code class="string">"text/css"</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">html, body {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">width:&nbsp; 100%;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">height: 100%;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">#canvas {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">background-color: #333333;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">position: absolute;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">top: 35px;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">#status {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">color: #FFFFFF;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">position: absolute;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">cursor: default;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-family: Helvetica, Verdana, sans-serif;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-weight: bold;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">margin: 10px;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">top: 30px;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">#controls {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">background-color: #AAAAAA;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">position: absolute;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-family: Helvetica, Verdana, sans-serif;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-weight: bold;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-size: smaller;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">padding: 3px;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">width: 594px;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">height: 25px;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">select {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-family: monospace;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">font-size: medium;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">* {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">padding:0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">margin:0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;/</code><code class="keyword">style</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;!--</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">Load Canvas support for IE8. ExplorerCanvas courtesy Google.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">See: http://code.google.com/p/explorercanvas/</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;!--[if lt IE 9]&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">&lt;script src="excanvas.js"&gt;&lt;/script&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;![endif]--&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;!--Load the OrbiterMicro JavaScript library (non-minified version). Use during development.--&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">script</code> <code class="color1">type</code><code class="plain">=</code><code class="string">"text/javascript"</code> <code class="color1">src</code><code class="plain">=</code><code class="string">"http://cdn.unioncloud.io/OrbiterMicro_latest.js"</code><code class="plain">&gt;&lt;/</code><code class="keyword">script</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">&lt;!--Load the OrbiterMicro JavaScript library (minified version). Use for production.--&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">&lt;!--&lt;script type="text/javascript" src="http://cdn.unioncloud.io/OrbiterMicro_latest_min.js"&gt;&lt;/script&gt;--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">&lt;!--Load UnionDraw application code--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">script</code> <code class="color1">src</code><code class="plain">=</code><code class="string">"UnionDraw.js"</code><code class="plain">&gt;&lt;/</code><code class="keyword">script</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;/</code><code class="keyword">head</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;</code><code class="keyword">body</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">&lt;!--Drop down menus for selecting line thickness and color--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">div</code> <code class="color1">id</code><code class="plain">=</code><code class="string">"controls"</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Size:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">select</code> <code class="color1">id</code><code class="plain">=</code><code class="string">"thickness"</code> <code class="color1">class</code><code class="plain">=</code><code class="string">"fixed"</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"1"</code><code class="plain">&gt;1&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"2"</code><code class="plain">&gt;2&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"3"</code><code class="plain">&gt;3&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"4"</code><code class="plain">&gt;4&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"5"</code><code class="plain">&gt;5&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"10"</code><code class="plain">&gt;10&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"20"</code><code class="plain">&gt;20&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;/</code><code class="keyword">select</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Color:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">select</code> <code class="color1">id</code><code class="plain">=</code><code class="string">"color"</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#FFFFFF"</code><code class="plain">&gt;#FFFFFF&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#AAAAAA"</code><code class="plain">&gt;#AAAAAA&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#666666"</code><code class="plain">&gt;#666666&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#000000"</code><code class="plain">&gt;#000000&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#9BA16C"</code><code class="plain">&gt;#9BA16C&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#CC8F2B"</code><code class="plain">&gt;#CC8F2B&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">option</code> <code class="color1">value</code><code class="plain">=</code><code class="string">"#63631D"</code><code class="plain">&gt;#63631D&lt;/</code><code class="keyword">option</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">&lt;/</code><code class="keyword">select</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">&lt;/</code><code class="keyword">div</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">&lt;!--The canvas where drawings will be displayed--&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">canvas</code> <code class="color1">id</code><code class="plain">=</code><code class="string">"canvas"</code><code class="plain">&gt;&lt;/</code><code class="keyword">canvas</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">&lt;!--A status text field, for displaying connection information--&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">&lt;</code><code class="keyword">div</code> <code class="color1">id</code><code class="plain">=</code><code class="string">"status"</code><code class="plain">&gt;&lt;/</code><code class="keyword">div</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">&lt;/</code><code class="keyword">body</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">&lt;/</code><code class="keyword">html</code><code class="plain">&gt;</code></td></tr></tbody></table></div></div></div>
</div>
<h2>UnionDraw.js</h2>
<div class="codeblock">
<div id="highlighter_172483" class="syntaxhighlighter nogutter  "><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// ORBITER VARIABLES</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// The Orbiter object, which is the root of Union's JavaScript client framework</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">orbiter;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// The MessageManager object, for sending and receiving messages</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">msgManager;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A convenience reference to net.user1.orbiter.UPC, which provides a</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// list of valid client/server UPC messages. See: http://unionplatform.com/specs/upc/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">UPC = net.user1.orbiter.UPC;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// The ID of the room users will join in order to draw together</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">roomID = </code><code class="string">"examples.uniondraw"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// A hash of client attribute names used in this application. Each client sets a</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// "thickness" attribute and a "color" attribute, specify the thickness and</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// color of the current line being drawn.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">Attributes = {THICKNESS:</code><code class="string">"thickness"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">COLOR:</code><code class="string">"color"</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A hash of room message names used in this application. MOVE means move the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// drawing pen to the specified position. PATH supplies a list of points to be</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// drawn.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">Messages = {MOVE:</code><code class="string">"MOVE"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">PATH:</code><code class="string">"PATH"</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// LOCAL USER VARIABLES</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// A flag to track whether the user is drawing or not</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">isPenDown = </code><code class="keyword">false</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Line defaults</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">defaultLineColor = </code><code class="string">"#AAAAAA"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">defaultLineThickness = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">maxLineThickness = 30;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Tracks the current location of the user's drawing pen</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">localPen = {};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// The user's line styles</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">localLineColor = defaultLineColor;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">localLineThickness = defaultLineThickness;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A list of points in a path to send to other connected users</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">bufferedPath = [];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A timestamp indicating the last time a point was added to the bufferedPath</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">lastBufferTime = </code><code class="keyword">new</code> <code class="plain">Date().getTime();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// REMOTE USER VARIABLES</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A hash of pen positions for remote users, in the following</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// format ("2345" is an example client ID):</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//&nbsp; {"2345": {x:10, y:10}}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">userCurrentPositions = {};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A hash of pending drawing commands sent by remote users, the following format:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//&nbsp; {"2345": [{commandName:moveTo, arg:{x:10, y:10}}, {commandName:lineTo, arg:{x:55, y:35}}]};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">userCommands = {};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// A hash of line colors for remote users, in the following format:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//&nbsp; {"2345": "#CCCCCC"};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">userColors = {};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// A hash of line thicknesses for remote users, in the following format:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//&nbsp; {"2345": 5};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">userThicknesses = {};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// DRAWING VARIABLES</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// The HTML5 drawing canvas</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">canvas;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// The drawing canvas's context, through which drawing commands are performed</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">context;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// A hash of drawing commands executed by UnionDraw's rendering process</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">DrawingCommands = {LINE_TO:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="string">"lineTo"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MOVE_TO:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="string">"moveTo"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_THICKNESS: </code><code class="string">"setThickness"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SET_COLOR:&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="string">"setColor"</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// TIMER VARIABLES</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// The ID for a timer that sends the user's drawing path on a regular interval</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">broadcastPathIntervalID;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// The ID for a timer that executes drawing commands sent by remote users</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">processDrawingCommandsIntervalID;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// TOUCH-DEVICE VARIABLES</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">hasTouch = </code><code class="keyword">false</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// INITIALIZATION</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Trigger init() when the document finishes loading</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">window.onload = init;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Main initialization function</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">init () {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">initCanvas();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">registerInputListeners();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">initOrbiter();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">iPhoneToTop();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Connecting to UnionDraw..."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Set up the drawing canvas</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">initCanvas () {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Retrieve canvas reference</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">canvas = document.getElementById(</code><code class="string">"canvas"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If IE8, do IE-specific canvas initialization (required by excanvas.js)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(</code><code class="keyword">typeof</code> <code class="plain">G_vmlCanvasManager != </code><code class="string">"undefined"</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">this</code><code class="plain">.canvas = G_vmlCanvasManager.initElement(</code><code class="keyword">this</code><code class="plain">.canvas);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Size canvas</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">canvas.width&nbsp; = 600;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">canvas.height = 400;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Retrieve context reference, used to execute canvas drawing commands</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context = canvas.getContext(</code><code class="string">'2d'</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.lineCap = </code><code class="string">"round"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Set control panel defaults</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.getElementById(</code><code class="string">"thickness"</code><code class="plain">).selectedIndex = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.getElementById(</code><code class="string">"color"</code><code class="plain">).selectedIndex = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Register callback functions to handle user input</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">registerInputListeners () {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">canvas.onmousedown = pointerDownListener;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.onmousemove = pointerMoveListener;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.onmouseup = pointerUpListener;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.ontouchstart = touchDownListener;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.ontouchmove = touchMoveListener;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.ontouchend = touchUpListener;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.getElementById(</code><code class="string">"thickness"</code><code class="plain">).onchange = thicknessSelectListener;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.getElementById(</code><code class="string">"color"</code><code class="plain">).onchange = colorSelectListener;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Initialize Orbiter, which handles multiuser communications</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">initOrbiter () {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Create the Orbiter instance, used to connect to and communicate with Union</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">orbiter = </code><code class="keyword">new</code> <code class="plain">net.user1.orbiter.Orbiter();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If required JavaScript capabilities are missing, abort</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(!orbiter.getSystem().isJavaScriptCompatible()) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Your browser is not supported."</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Register for Orbiter's connection events</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">orbiter.addEventListener(net.user1.orbiter.OrbiterEvent.READY, readyListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">orbiter.addEventListener(net.user1.orbiter.OrbiterEvent.CLOSE, closeListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Retrieve a reference to the MessageManager, used for sending messages to</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// and receiving messages from Union Server</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager = orbiter.getMessageManager();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Connect to Union Server (at the public testing site)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">orbiter.connect(</code><code class="string">"tryunion.com"</code><code class="plain">, 80);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// ORBITER EVENT LISTENERS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when the connection to Union Server is ready</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">readyListener (e) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Register for UPC messages from Union Server</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(UPC.JOINED_ROOM, joinedRoomListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(UPC.ROOM_OCCUPANTCOUNT_UPDATE,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomOccupantCountUpdateListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(UPC.ROOM_SNAPSHOT, roomSnapshotListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(UPC.CLIENT_ATTR_UPDATE, clientAttributeUpdateListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(UPC.CLIENT_REMOVED_FROM_ROOM, clientRemovedFromRoomListener, </code><code class="keyword">this</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Register for custom messages from other users</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(Messages.MOVE, moveMessageListener, </code><code class="keyword">this</code><code class="plain">, [roomID]);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.addMessageListener(Messages.PATH, pathMessageListener, </code><code class="keyword">this</code><code class="plain">, [roomID]);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Create a room for the drawing app, then join it</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.CREATE_ROOM, roomID);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.JOIN_ROOM, roomID);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when the connection to Union Server is closed</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">closeListener (e) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Disconnected from UnionDraw."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Stop drawing content sent by other users</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">clearInterval(processDrawingCommandsIntervalID);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when this client has joined the server-side drawing room</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">joinedRoomListener (roomID) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Periodically execute drawing commands sent by other users</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">processDrawingCommandsIntervalID = setInterval(processDrawingCommands, 20);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when this client is informed that number of users in the</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// server-side drawing room has changed</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">roomOccupantCountUpdateListener (roomID, numOccupants) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">numOccupants = parseInt(numOccupants);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(numOccupants == 1) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Now drawing on your own (no one else is here at the moment)"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="keyword">if</code> <code class="plain">(numOccupants == 2) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Now drawing with "</code> <code class="plain">+ (numOccupants-1) + </code><code class="string">" other person"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">setStatus(</code><code class="string">"Now drawing with "</code> <code class="plain">+ (numOccupants-1) + </code><code class="string">" other people"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// HANDLE INCOMING CLIENT ATTRIBUTES</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when Union Server sends a "snapshot" describing the drawing room,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// including a list of users supplied as unnamed arguments after the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// roomAttributes parameter. For a description of roomSnapshotListener()'s</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// parameters, see "u54" in the UPC specification,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// at: http://unionplatform.com/specs/upc/. This client receives the room</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// snapshot automatically when it the joins the drawing room.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">roomSnapshotListener (requestID,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">occupantCount,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">observerCount,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomAttributes) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// The unnamed arguments following 'roomAttributes' is a list of</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// clients in the room. Assign that list to clientList.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">clientList = Array.prototype.slice.call(arguments).slice(5);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">clientID;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">roomAttrString;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">roomAttrs;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">attrName;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">attrVal;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Loop through the list of clients in the room to get each client's</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// "thickness" and "color" attributes.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">(</code><code class="keyword">var</code> <code class="plain">i = 0; i &lt; clientList.length; i+=5) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">clientID = clientList[i];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Each client's room-scoped client attributes are passed as a</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// pipe-delimited string. Split that string to get the attributes.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">clientAttrString = clientList[i+4];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">clientAttrs = clientAttrString == </code><code class="string">""</code> <code class="plain">? [] : clientAttrString.split(</code><code class="string">"|"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Pass each client attribute to processClientAttributeUpdate(), which will</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// check for the "thickness" and "color" attributes.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">(</code><code class="keyword">var</code> <code class="plain">j = 0; j &lt; clientAttrs.length; j++) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">attrName = clientAttrs[j];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">attrVal&nbsp; = clientAttrs[j+1];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">processClientAttributeUpdate(clientID, attrName, attrVal);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when one of the clients in the drawing room changes an attribute</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// value. When an attribute value changes, check to see whether it was either</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// the "thickness" attribute or the "color" attribute.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">clientAttributeUpdateListener (attrScope,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">clientID,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userID,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">attrName,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">attrVal,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">attrOptions) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(attrScope == roomID) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">processClientAttributeUpdate(clientID, attrName, attrVal);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when a clients leaves the drawing room.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">clientRemovedFromRoomListener (roomID, clientID) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// The client is gone now, so remove all information pertaining to that client</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">delete</code> <code class="plain">userThicknesses[clientID];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">delete</code> <code class="plain">userColors[clientID];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">delete</code> <code class="plain">userCommands[clientID];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">delete</code> <code class="plain">userCurrentPositions[clientID];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Checks for changes to the the "thickness" and "color" attributes.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">processClientAttributeUpdate (clientID, attrName, attrVal) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(attrName == Attributes.THICKNESS) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// The "thickness" attribute changed, so push a "set thickness" command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// onto the drawing command stack for the specified client. But first,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// bring the thickness into legal range if necessary (prevents thickness hacking).</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">addDrawingCommand(clientID, DrawingCommands.SET_THICKNESS, getValidThickness(attrVal));</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="keyword">if</code> <code class="plain">(attrName == Attributes.COLOR) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// The "color" attribute changed, so push a "set color" command</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// onto the drawing command stack for the specified client</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">addDrawingCommand(clientID, DrawingCommands.SET_COLOR, attrVal);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// HANDLE INCOMING CLIENT MESSAGES</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when a remote client sends a "MOVE" message to this client</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">moveMessageListener (fromClientID, coordsString) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Parse the specified (x, y) coordinate</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">coords = coordsString.split(</code><code class="string">","</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">position = {x:parseInt(coords[0]), y:parseInt(coords[1])};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Push a "moveTo" command onto the drawing-command stack for the sender</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">addDrawingCommand(fromClientID, DrawingCommands.MOVE_TO, position);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when a remote client sends a "PATH" message to this client</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">pathMessageListener (fromClientID, pathString) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Parse the specified list of points</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">path = pathString.split(</code><code class="string">","</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// For each point, push a "lineTo" command onto the drawing-command stack</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// for the sender</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">position;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">(</code><code class="keyword">var</code> <code class="plain">i = 0; i &lt; path.length; i+=2) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">position = {x:parseInt(path[i]), y:parseInt(path[i+1])};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">addDrawingCommand(fromClientID, DrawingCommands.LINE_TO, position);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// BROADCAST DRAWING DATA TO OTHER USERS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Sends the local user's drawing-path information to other users in the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// drawing room.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">broadcastPath () {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If there aren't any points buffered (e.g., if the pen is down but not</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// moving), then don't send the PATH message.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(bufferedPath.length == 0) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Use SEND_MESSAGE_TO_ROOMS to deliver the message to all users in the room</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Parameters are: messageName, roomID, includeSelf, filters, ...args. For</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// details, see http://unionplatform.com/specs/upc/.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.SEND_MESSAGE_TO_ROOMS,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Messages.PATH,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"false"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bufferedPath.join(</code><code class="string">","</code><code class="plain">));</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Clear the local user's outgoing path data</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">bufferedPath = [];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If the user is no longer drawing, stop broadcasting drawing information</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(!isPenDown) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">clearInterval(broadcastPathIntervalID);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Sends all users in the drawing room an instruction to reposition the local</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// user's pen.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">broadcastMove (x, y) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.SEND_MESSAGE_TO_ROOMS,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Messages.MOVE,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"false"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">x + </code><code class="string">","</code> <code class="plain">+ y);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// PROCESS DRAWING COMMANDS FROM OTHER USERS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Pushes a drawing command onto the command stack for the specified client.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// At a regular interval, commands are pulled off the stack and executed,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// causing remote user's drawings to appear on-screen.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">addDrawingCommand (clientID, commandName, arg) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If this client does not yet have a command stack, make one.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(userCommands[clientID] == undefined) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCommands[clientID] = [];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Push the command onto the stack.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">command = {};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">command[</code><code class="string">"commandName"</code><code class="plain">] = commandName;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">command[</code><code class="string">"arg"</code><code class="plain">] = arg;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">userCommands[clientID].push(command);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Executes the oldest command on all user's command stacks</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">processDrawingCommands () {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">command;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Loop over all command stacks</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">(</code><code class="keyword">var</code> <code class="plain">clientID </code><code class="keyword">in</code> <code class="plain">userCommands) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Skip empty stacks</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(userCommands[clientID].length == 0) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">continue</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Execute the user's oldest command</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">command = userCommands[clientID].shift();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">switch</code> <code class="plain">(command.commandName) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">DrawingCommands.MOVE_TO:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID] = {x:command.arg.x, y:command.arg.y};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">DrawingCommands.LINE_TO:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(userCurrentPositions[clientID] == undefined) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID] = {x:command.arg.x, y:command.arg.y};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">drawLine(userColors[clientID] || defaultLineColor,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userThicknesses[clientID] || defaultLineThickness,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID].x,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID].y,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">command.arg.x,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">command.arg.y);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID].x = command.arg.x;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userCurrentPositions[clientID].y = command.arg.y;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">DrawingCommands.SET_THICKNESS:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userThicknesses[clientID] = command.arg;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">DrawingCommands.SET_COLOR:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">userColors[clientID] = command.arg;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// TOUCH-INPUT EVENT LISTENERS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// On devices that support touch input, this function is triggered when the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// user touches the screen.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">touchDownListener (e) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Note that this device supports touch so that we can prevent conflicts with</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// mouse input events.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">hasTouch = </code><code class="keyword">true</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Prevent the touch from scrolling the page, but allow interaction with the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// control-panel menus. The "event.target.nodeName" variable provides the name</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// of the HTML element that was touched.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(event.target.nodeName != </code><code class="string">"SELECT"</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">e.preventDefault();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Determine where the user touched screen.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">touchX = e.changedTouches[0].clientX - canvas.offsetLeft;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">touchY = e.changedTouches[0].clientY - canvas.offsetTop;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// A second "touch start" event may occur if the user touches the screen with</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// two fingers. Ignore the second event if the pen is already down.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(!isPenDown) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Move the drawing pen to the position that was touched</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">penDown(touchX, touchY);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// On devices that support touch input, this function is triggered when the user</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// drags a finger across the screen.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">touchMoveListener (e) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">hasTouch = </code><code class="keyword">true</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">e.preventDefault();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">touchX = e.changedTouches[0].clientX - canvas.offsetLeft;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">touchY = e.changedTouches[0].clientY - canvas.offsetTop;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Draw a line to the position being touched.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">penMove(touchX, touchY);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// On devices that support touch input, this function is triggered when the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// user stops touching the screen.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">touchUpListener () {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// "Lift" the drawing pen, so lines are no longer drawn</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">penUp();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// MOUSE-INPUT EVENT LISTENERS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when the mouse is pressed down</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">pointerDownListener (e) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// If this is an iPhone, iPad, Android, or other touch-capable device, ignore</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// simulated mouse input.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(hasTouch) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Retrieve a reference to the Event object for this mousedown event.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Internet Explorer uses window.event; other browsers use the event parameter</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">event = e || window.event;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Determine where the user clicked the mouse.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">mouseX = event.clientX - canvas.offsetLeft;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">mouseY = event.clientY - canvas.offsetTop;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Move the drawing pen to the position that was clicked</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">penDown(mouseX, mouseY);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// We want mouse input to be used for drawing only, so we need to stop the</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// browser from/ performing default mouse actions, such as text selection.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// In Internet Explorer, we "prevent default actions" by returning false. In</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// other browsers, we invoke event.preventDefault().</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(event.preventDefault) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(event.target.nodeName != </code><code class="string">"SELECT"</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">event.preventDefault();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="keyword">false</code><code class="plain">;&nbsp; </code><code class="comments">// IE</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when the mouse moves</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">pointerMoveListener (e) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(hasTouch) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">event = e || window.event; </code><code class="comments">// IE uses window.event, not e</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">mouseX = event.clientX - canvas.offsetLeft;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">mouseY = event.clientY - canvas.offsetTop;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Draw a line if the pen is down</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">penMove(mouseX, mouseY);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Prevent default browser actions, such as text selection</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(event.preventDefault) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">event.preventDefault();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="keyword">false</code><code class="plain">;&nbsp; </code><code class="comments">// IE</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when the mouse button is released</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">pointerUpListener (e) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(hasTouch) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// "Lift" the drawing pen</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">penUp();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// CONTROL PANEL MENU-INPUT EVENT LISTENERS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// Triggered when an option in the "line thickness" menu is selected</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">thicknessSelectListener (e) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Determine which option was selected</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">newThickness = </code><code class="keyword">this</code><code class="plain">.options[</code><code class="keyword">this</code><code class="plain">.selectedIndex].value;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Locally, set the line thickness to the selected value</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">localLineThickness = getValidThickness(newThickness);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Share the selected thickness with other users by setting the client</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// attribute named "thickness". Attributes are automatically shared with other</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// clients in the room, triggering clientAttributeUpdateListener().</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Arguments for SET_CLIENT_ATTR are:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; clientID</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; userID (None in this case)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; attrName</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; escapedAttrValue</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; attrScope (The room)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp; attrOptions (An integer whose bits specify options. "4" means</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the attribute should be shared).</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.SET_CLIENT_ATTR,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">orbiter.getClientID(),</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Attributes.THICKNESS,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">newThickness,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"4"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// After the user selects a value in the drop-down menu, the iPhone</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// automatically scrolls the page, so scroll back to the top-left.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">iPhoneToTop();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Triggered when an option in the "line color" menu is selected</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">colorSelectListener (e) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Determine which option was selected</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">newColor = </code><code class="keyword">this</code><code class="plain">.options[</code><code class="keyword">this</code><code class="plain">.selectedIndex].value;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Locally, set the line color to the selected value</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">localLineColor = newColor;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Share selected color with other users</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">msgManager.sendUPC(UPC.SET_CLIENT_ATTR,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">orbiter.getClientID(),</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">""</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Attributes.COLOR,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">newColor,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">roomID,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"4"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Scroll the iPhone back to the top-left.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">iPhoneToTop();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// PEN</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Places the pen in the specified location without drawing a line. If the pen</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// subsequently moves, a line will be drawn.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">penDown (x, y) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">isPenDown = </code><code class="keyword">true</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">localPen.x = x;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">localPen.y = y;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Send this user's new pen position to other users.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">broadcastMove(x, y);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Begin sending this user's drawing path to other users every 500 milliseconds.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">broadcastPathIntervalID = setInterval(broadcastPath, 500);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Draws a line if the pen is down.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">penMove (x, y) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(isPenDown) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Buffer the new position for broadcast to other users. Buffer a maximum</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// of 100 points per second.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">((</code><code class="keyword">new</code> <code class="plain">Date().getTime() - lastBufferTime) &gt; 10) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bufferedPath.push(x + </code><code class="string">","</code> <code class="plain">+ y);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lastBufferTime = </code><code class="keyword">new</code> <code class="plain">Date().getTime();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Draw the line locally.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">drawLine(localLineColor, localLineThickness, localPen.x, localPen.y, x, y);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Move the pen to the end of the line that was just drawn.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">localPen.x = x;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">localPen.y = y;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">// "Lifts" the drawing pen, so that lines are no longer draw when the mouse or</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// touch-input device moves.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">penUp () {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">isPenDown = </code><code class="keyword">false</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// DRAWING</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Draws a line on the HTML5 canvas</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">drawLine (color, thickness, x1, y1, x2, y2) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.strokeStyle = color;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.lineWidth&nbsp;&nbsp; = thickness;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.beginPath();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.moveTo(x1, y1)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.lineTo(x2, y2);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.stroke();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// STATUS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Updates the text of the on-screen HTML "status" div tag</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">setStatus (message) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">document.getElementById(</code><code class="string">"status"</code><code class="plain">).innerHTML = message;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// IPHONE UTILS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// Hides the iPhone address bar by scrolling it out of view</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">iPhoneToTop () {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(navigator.userAgent.indexOf(</code><code class="string">"iPhone"</code><code class="plain">) != -1) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">setTimeout (</code><code class="keyword">function</code> <code class="plain">() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">window.scroll(0, 0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}, 100);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="comments">// DATA VALIDATION</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="comments">//==============================================================================</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">function</code> <code class="plain">getValidThickness (value) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">value = parseInt(value);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">thickness = isNaN(value) ? defaultLineThickness : value;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">Math.max(1, Math.min(thickness, maxLineThickness));</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
</div>
<p>For more information on creating connected applications with JavaScript using the Union platform, see <a href="http://www.unionplatform.com/?page_id=3248">Orbiter</a> and <a href="http://www.unionplatform.com/?page_id=1587">OrbiterMicro's documentation</a>.</p>


</div>

</div>
	
</div>

</div>


<div id="footer">

<div id="footertext">
Copyright © 2017
<a href="http://user1.net/" title="USER1 Subsystems Corporation">USER1 Subsystems Corporation</a>
</div>

<div id="credits">
<a href="http://unionplatform.com/forums" title="Suggestions/comments?">Questions/comments?</a>
</div>

</div>

<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shCore.js"></script>
<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shBrushJScript.js"></script>
<script type="text/javascript" src="./Multiuser Drawing Pad Built with Pure JavaScript_HTML5_Canvas • The Union Platform, By USER1_files/shBrushXml.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.unionplatform.com/wp/wp-content/plugins/syntaxhighlighter/syntaxhighlighter/styles/shCore.css?ver=2.1.364b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].appendChild(corecss);
		var themecssurl = "http://www.unionplatform.com/wp/wp-content/plugins/syntaxhighlighter/syntaxhighlighter/styles/shThemeFadeToGrey.css?ver=2.1.364b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.getElementsByTagName("head")[0].appendChild(themecss);
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://www.unionplatform.com/wp/wp-content/plugins/syntaxhighlighter/syntaxhighlighter/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['tab-size'] = 2;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.defaults['wrap-lines'] = false;
	SyntaxHighlighter.all();
</script>


</body></html>